[Unit]
Description=confd configuration management
Documentation=https://github.com/abtreece/confd
After=network-online.target
Wants=network-online.target

[Service]
Type=notify
User=confd
Group=confd

# Main service command with systemd integration
ExecStart=/usr/local/bin/confd etcd \
  --systemd-notify \
  --watchdog-interval=30s \
  --watch \
  --log-level=info

# Reload configuration on SIGHUP
ExecReload=/bin/kill -HUP $MAINPID

# Graceful shutdown
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=30

# Watchdog configuration (must be > watchdog-interval)
WatchdogSec=60s

# Restart behavior
Restart=on-failure
RestartSec=5s

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/confd /etc/confd

# Resource limits
LimitNOFILE=65536

[Install]
WantedBy=multi-user.target
